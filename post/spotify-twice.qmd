---
title: "Spotifyã‚’Pythonã§åˆ†æ Twiceç·¨"
format: html
code-fold: false
date: last-modified
toc: true
toc-location: left
lang: ja
draft: true
---

## å‰å›ã¾ã§ã®å‰æº–å‚™

[å‰å›](/spotify-basis.html) å‰æº–å‚™ã¯ã“ã“ã«è¼‰ã£ã¦ã„ã¾ã™ã€‚

```{python}
import pandas as pd
import spotipy
from spotipy.oauth2 import SpotifyClientCredentials
import json
import os
from dotenv import load_dotenv
from pprint import pprint

client_id = os.getenv('SPOTIFY_CLIENT_ID')
client_secret = os.getenv('SPOTIFY_CLIENT_SECRET')

client_credentials_manager = spotipy.oauth2.SpotifyClientCredentials(client_id, client_secret)
sp = spotipy.Spotify(client_credentials_manager=client_credentials_manager)
```

## ã‚„ã‚ŠãŸã„ã“ã¨

- Twiceã®æ›²èª¿ã®å¤‰é·ï¼ˆã‚¢ãƒ«ãƒãƒ ã‚¿ã‚¤ãƒˆãƒ«æ›²ï¼‰ãƒ»æ™‚æœŸçš„ãªå¤‰ã‚ã‚Šæ–¹
  - äºˆæ¸¬ï¼šYes or Yesã‚’å¢ƒã«ã‚¬ãƒ©ãƒƒã¨å¤‰ã‚ã£ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã‹
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ†æ
  - äºˆæ¸¬ï¼šï¼“ã‚¯ãƒ©ã‚¹ã‚¿ã§å¯æ„›ã„æ›²èª¿ï¼ˆTTãƒ»What is Loveï¼‰ã€ã‚¯ãƒ¼ãƒ«æ›²èª¿ï¼ˆCry for me, SET ME Freeï¼‰ã€å…ƒæ°—ç³»ï¼ˆCheer up, LIKE OHH AHHï¼‰ã«ãŠãŠã¾ã‹ã«ã¯åˆ¥ã‚Œã‚‹ã®ã§ã¯ï¼Ÿ

## èª­ã¿è¾¼ã‚€ï¼

twiceã®ã‚¿ã‚¤ãƒˆãƒ«æ›²ã‚’æ¯”è¼ƒã™ã‚‹ã«ã¯ã€æœ‰ååº¦åˆã„ã§èª¿ã¹ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚

```{python}
twice_url = 'https://open.spotify.com/intl-ja/artist/7n2Ycct7Beij7Dj7meI4X0?si=wpbUsAFKTz634tK-rLZenA'
results = sp.artist_top_tracks(twice_url)
```

```{python}
for track in results['tracks'][:10]:
    print('track    : ' + track['name'])
    print()
```

è‰¯ã„èª¿ã¹æ–¹ã ã¨æ€ã£ãŸã®ã§ã™ãŒã€`artist_top_tracks`ã¯10å€‹ã®ã¿ã ãã†ã§ã™ğŸ˜­


ä»–ã®æ–¹æ³•ã‚‚è©¦ã—ã¦ã¿ãŸã®ã§ã™ãŒã€Playlistã‚’æ´»ç”¨ã™ã‚‹ã®ãŒä¸€ç•ªè‰¯ã•ãã†ã§ã™ã€‚


```{python}
twice_playlist_url = 'https://open.spotify.com/playlist/394Th9t58FlwC3ElNlqGye?si=e18959b04e0c4b48'
twice_playlist_id = twice_playlist_url.split('/')[-1].split('?')[0]  #ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆIDã‚’å–å¾—

# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®æ¥½æ›²ä¸€è¦§ã‚’å–å¾—
twice_playlist = sp.playlist(twice_playlist_id)
```

```{python}
twice_playlist["tracks"]["items"][2]["track"]
```


```{python}
# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®æ›²æƒ…å ±ã‚’æ ¼ç´ã™ã‚‹ãƒªã‚¹ãƒˆ
playlist_tracks = []

# å„ãƒˆãƒ©ãƒƒã‚¯ã®æƒ…å ±ã‚’å–å¾—
for item in twice_playlist['tracks']['items']:
    track = item['track']
    track_info = {
        'æ›²å': track['name'],
        'ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ': ', '.join([artist['name'] for artist in track['artists']]),
        'ã‚¢ãƒ«ãƒãƒ ': track['album']['name'],
        'ãƒªãƒªãƒ¼ã‚¹æ—¥': track['album']['release_date']
    }
    playlist_tracks.append(track_info)
```

```{python}
# ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã«å¤‰æ›
df = pd.DataFrame(playlist_tracks)
df
```

ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã„ã¤ã§ã‚‚æ´»ç”¨ã§ãã‚‹ã‚ˆã†csvãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã—ã¾ã™ï¼

```{python}
df.to_csv('twice.csv') 
```

ã“ã“ã‹ã‚‰ã€ãã‚Œãã‚Œã®æ¥½æ›²ã®`danceability`ãªã©ã®å±æ€§ã‚’å–å¾—ã—ãŸã„ã®ã§ã™ãŒã€ã‚ˆã„è¨˜äº‹ãŒã‚ã£ãŸã®ã§ã“ã‚Œã‚’å‚è€ƒã«ã—ãªãŒã‚‰é€²ã‚ã¦ã„ãã¾ã™ï¼

### å±æ€§å–å¾—

å‚è€ƒã«ã™ã‚‹è¨˜äº‹ï¼š[https://qiita.com/sayuyuyu/items/4ca06a851fca41f6b270](https://qiita.com/sayuyuyu/items/4ca06a851fca41f6b270)

ã‚„ã‚ŠãŸã„ã“ã¨ã‚’æ°—åˆã„ã§ã‚„ã£ã¦ãã‚Œã¦ã‚‹äººãŒã„ã¾ã—ãŸï¼ï¼ï¼

```{python}
# ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‹ã‚‰æ›²ã‚’å–å¾—
def get_to_playlist(playlist_id):
    playlist = sp.playlist(playlist_id)
    track_ids = []
    for item in playlist['tracks']['items']:
        track = item['track']
        if not track['id'] in track_ids:
            track_ids.append(track['id'])
        else:
            for item in playlist['tracks']['items']:
                track = item['track']
                if not track['id'] in track_ids:
                    track_ids.append(track['id'])
    return track_ids
```

```{python}
def getTrackFeatures(id):
    meta = sp.track(id)
    features = sp.audio_features(id)

    name = meta['name']
    album = meta['album']['name']
    artist = meta['album']['artists'][0]['name']
    release_date = meta['album']['release_date']
    length = meta['duration_ms']
    popularity = meta['popularity']
    key = features[0]['key']
    mode = features[0]['mode']
    danceability = features[0]['danceability']
    acousticness = features[0]['acousticness']
    energy = features[0]['energy']
    instrumentalness = features[0]['instrumentalness']
    liveness = features[0]['liveness']
    loudness = features[0]['loudness']
    speechiness = features[0]['speechiness']
    tempo = features[0]['tempo']
    time_signature = features[0]['time_signature']
    valence = features[0]['valence']

    track = [name, album, artist, release_date, length, popularity, key, mode, danceability, acousticness,
             energy, instrumentalness, liveness, loudness, speechiness, tempo, time_signature, valence]
    return track
```

```{python}
def id_to_csv(track_ids):
    tracks = []
    for track_id in track_ids:
        track = getTrackFeatures(track_id)
        tracks.append(track)

    df = pd.DataFrame(tracks, columns=['name', 'album', 'artist', 'release_date', 'length', 'popularity', 'key', 'mode', 'danceability',
                      'acousticness', 'energy', 'instrumentalness', 'liveness', 'loudness', 'speechiness', 'tempo', 'time_signature', 'valence'])
    df.head()

    df.to_csv('myplaylist.csv', encoding='utf-8', index=False)
    print("CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚")

    return df
```

```python
if __name__ == '__main__':
    ids = get_to_playlist("394Th9t58FlwC3ElNlqGye")
    id_to_csv(ids)
```



## ã„ã–åˆ†æ

```{python}
twice_df = pd.read_csv("myplaylist.csv")

twice_df.head()
```

ã¾ãšãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ•´ç†ã—ã¦ã„ãã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ•´ç†

#### æ—¥ä»˜ã‚’æ•´ç†

ã¾ãšã€`release_date`é †ã«ä¸¦ã³æ›¿ãˆã¾ã™ã€‚

ãã®å‰ã«å‹ãŒã¡ã‚ƒã‚“ã¨æ—¥ä»˜ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºã‹ã‚ã¾ã™ã€‚

```{python}
type(twice_df["release_date"][0])
```

åˆ—å˜ä½ã§å‹ã‚’è¦‹ã‚‹æ–¹æ³•ã£ã¦ã‚ã‚‹ã®ã‹ãªï¼Ÿï¼Ÿâ†’[https://pyhoo.jp/pandas-astype](https://pyhoo.jp/pandas-astype) ã«ã‚ˆã‚‹ã¨ã€pandasã®æ©Ÿèƒ½ã§dtypesã£ã¦ã„ã†ã®ãŒã‚ã‚‹ãã†ã€‚

```{python}
twice_df.dtypes
```

å…¨éƒ¨ã®å‹ãŒè¦‹ã‚Œã¦ä¾¿åˆ©ï¼

ã‚„ã£ã±ã‚Š`object`ã«ãªã£ã¦ã„ãŸã®ã§ã€`datetime`å‹ã«å¤‰æ›ã—ã¾ã™ã€‚

```{python}
#| error: true
twice_df["release_date"] = pd.to_datetime(twice_df["release_date"])
```

ã¨ã“ã‚ãŒã©ã£ã“ã„ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã­ã€‚
ã‚¨ãƒ©ãƒ¼ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ä¸€ã¤ã ã‘`2015`ã¨ã„ã†å¹´ã ã‘ã‚ã‹ã£ã¦ãŠã‚Šã€ `%Y-%m-%d`ã®å½¢ã«æ²¿ã£ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ã ã¨æ€ã„ã¾ã™ã€‚



```{python}
sum(twice_df["release_date"] == '2015')
```

2015ã«ãªã£ã¦ã„ã‚‹ã®ã¯ä¸€ã¤ã ã‘ã§ã™ã­ã€‚
ã©ã‚Œã‹ã‚’ç‰¹å®šã—ã¾ã™ã€‚

```{python}
twice_df[twice_df["release_date"] == '2015']
```

LIKE OHH AHHã®ã‚ˆã†ã§ã™ã­ã€‚
ã“ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã€`2015-10-20`ã«ç›´æ¥å¤‰æ›ã—ã¾ã™ã€‚ï¼ˆèª¿ã¹ã¾ã—ãŸï¼ï¼‰

```{python}
twice_df.loc[8, 'release_date'] = '2015-10-20'
```

```{python}
sum(twice_df["release_date"] == '2015')
```

2015ã®ã‚‚ã®ãŒãªããªã£ãŸã®ã§ã€å¤‰æ›ã§ãã‚‹ã¯ãšã§ã™ï¼å†åº¦`to_datetime`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```{python}
twice_df["release_date"] = pd.to_datetime(twice_df["release_date"])
```

```{python}
twice_df.dtypes
```

å‹ã‚’è¦‹ã‚‹ã¨å¤‰æ›ã§ãã¦ã¾ã™ã­ã€‚



```{python}
twice_df.sort_values('release_date', ascending=True)
```

```{python}
twice_df=twice_df.sort_values('release_date', ascending=True)
```

artistãŒTwiceã®ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚‚ã®ã‚‚ã‚ã‚‹ã®ã§ã€ãã‚Œã¯ã®ããã¾ã™ã€‚

```{python}
twice_df = twice_df[twice_df["artist"] == 'TWICE']
```

```{python}
import matplotlib.pyplot as plt

plt.plot(twice_df["release_date"], twice_df["valence"], marker="o")
plt.plot(twice_df["release_date"], twice_df["energy"], marker="o")
plt.show()
```

ã“ã“ã‹ã‚‰ã©ã†ã«ã‹ã—ã¦ã„ããŸã„ã§ã™ã­
